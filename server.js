var PORT = 80;
var BROADCAST_ADDR = "255.255.255.255";
var dgram = require('dgram');
var server = dgram.createSocket("udp4");

server.bind(function () {
  server.setBroadcast(true);
  setInterval(broadcastNew, 3000);
});

function broadcastNew() {
  function checksum(data) {
    let res = 0x00
    for (let i = 0; i < data.length; ++i) {
      res = (res + data[i]) & 0xFF
    }
    return Buffer.from([res])
  }

  let data = Buffer.from([0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc6, 0xc4, 0x00, 0x00, 0x00, 0x00, 0x14, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x06, 9, 0x03, 0x00])

    data[68] = 84
    data[69] = 104
    data[70] = 101
    data[71] = 111
    data[72] = 70
    data[73] = 105

    data[100] = 116
    data[101] = 104
    data[102] = 101
    data[103] = 111
    data[104] = 98
    data[105] = 97
    data[106] = 108
    data[107] = 100
    data[108] = 111

  server.send(data, 0, data.length, PORT, BROADCAST_ADDR, function () {
    console.log("Sent '" + data + "'");
  });
}